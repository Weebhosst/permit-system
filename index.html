<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistem Permit Kendaraan - Barcode + Scanner + Spreadsheet/SQL</title>
    <meta name="description" content="Aplikasi web untuk manajemen permit data kendaraan dengan barcode, scanner otomatis, impor dari Google Spreadsheet (CSV), dan database SQL (SQLite di browser).">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkfP+Po86l4N1ZqLgGqF9Q9GZ8V4G4D5l6nNmJXKkQq5rQ31xM4Q0SYJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@0.20.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <style>
      :root {
        --brand: #0ea5e9;
        --brand-dark: #0284c7;
        --ink: #0f172a;
        --muted: #64748b;
        --bg: #0b1220;
        --card: rgba(255,255,255,0.06);
        --stroke: rgba(255,255,255,0.12);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
      }
      html, body {
        background: radial-gradient(1200px 800px at 80% -20%, rgba(56,189,248,0.15), transparent 60%),
                    radial-gradient(900px 600px at 10% 10%, rgba(16,185,129,0.12), transparent 50%),
                    #0b1220;
        color: #e5e7eb;
        min-height: 100%;
      }
      .glass {
        background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
        border: 1px solid var(--stroke);
        backdrop-filter: blur(10px);
      }
      .card {
        background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
        border: 1px solid var(--stroke);
        border-radius: 14px;
      }
      .stroke {
        border: 1px solid var(--stroke);
      }
      .tab-active {
        background: linear-gradient(180deg, rgba(56,189,248,0.18), rgba(56,189,248,0.08));
        border: 1px solid rgba(56,189,248,0.35);
        color: #e0f2fe;
        box-shadow: 0 0 0 3px rgba(56,189,248,0.1);
      }
      .grid-auto-fit {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1rem;
      }
      .scanner-frame {
        position: absolute;
        inset: 10%;
        border: 2px dashed rgba(56,189,248,0.65);
        border-radius: 16px;
        box-shadow: 0 0 0 20000px rgba(0,0,0,0.35) inset;
        pointer-events: none;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: .4rem;
        font-size: .8rem;
        border-radius: 9999px;
        padding: .25rem .6rem;
        border: 1px solid var(--stroke);
        background: rgba(255,255,255,0.06);
      }
      .status-active  { background: rgba(16,185,129,0.15); border-color: rgba(16,185,129,0.35); color: #a7f3d0; }
      .status-expired { background: rgba(239,68,68,0.15);  border-color: rgba(239,68,68,0.35);  color: #fecaca; }
      .status-pending { background: rgba(245,158,11,0.15); border-color: rgba(245,158,11,0.35); color: #fde68a; }
      .table-wrap { overflow: auto; border-radius: 12px; border: 1px solid var(--stroke); }
      table thead th { background: rgba(255,255,255,0.06); text-align: left; font-weight: 600; color: #cbd5e1; }
      table td, table th { padding: .75rem .9rem; white-space: nowrap; }
      .print-card {
        width: 86mm; height: 54mm; /* ID-1 card */
        background: white; color: #111827;
        border-radius: 8px; border: 1px solid #e5e7eb;
        padding: 10px; display: grid; grid-template-rows: auto 1fr auto; gap: 6px;
      }
      .print-card .hline { height: 1px; background: #e5e7eb; }
      .fade-in { animation: fade .25s ease-out; }
      @keyframes fade { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: none; } }
      @media print {
        body * { visibility: hidden; }
        #print-area, #print-area * { visibility: visible; }
        #print-area { position: absolute; inset: 0; background: white; padding: 16px; }
      }
    </style>
  </head>
  <body class="antialiased">
    <header class="sticky top-0 z-30 glass">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-lg bg-sky-500/20 border border-sky-400/30 flex items-center justify-center text-sky-300">
            <i class="fa-solid fa-car-rear"></i>
          </div>
          <div>
            <h1 class="text-xl font-semibold tracking-wide">Sistem Permit Kendaraan</h1>
            <p class="text-xs text-slate-400 -mt-1">Barcode • Scanner Otomatis • Spreadsheet/SQL</p>
          </div>
        </div>
        <div class="hidden md:flex items-center gap-2">
          <button id="saveDbBtn" class="px-3 py-2 rounded-lg border border-sky-400/30 hover:border-sky-400/60 text-sky-200 hover:text-sky-100">Simpan ke Browser</button>
          <button id="exportDbBtn" class="px-3 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30 text-sky-50"><i class="fa-solid fa-download mr-2"></i>Unduh Database</button>
        </div>
      </div>
      <nav class="max-w-7xl mx-auto px-4 pb-4">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-2">
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="dashboard"><i class="fa-solid fa-gauge-high mr-2"></i>Dashboard</button>
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="data"><i class="fa-solid fa-table mr-2"></i>Data</button>
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="new"><i class="fa-solid fa-square-plus mr-2"></i>Tambah Permit</button>
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="scan"><i class="fa-solid fa-barcode mr-2"></i>Scan Barcode</button>
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="logs"><i class="fa-solid fa-clipboard-list mr-2"></i>Log</button>
          <button class="tab-btn card px-3 py-2 rounded-xl" data-tab="import"><i class="fa-solid fa-file-import mr-2"></i>Impor/Ekspor</button>
        </div>
      </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 space-y-8 py-6">
      <section class="relative card rounded-2xl overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-sky-500/10 via-emerald-500/10 to-transparent"></div>
        <div class="relative grid md:grid-cols-2 gap-6 p-6">
          <div class="space-y-3">
            <h2 class="text-2xl font-semibold">Kelola Akses Kendaraan dengan Cepat dan Aman</h2>
            <p class="text-slate-300">Buat permit, generate barcode, scan otomatis menggunakan kamera, catat keluar/masuk, dan sinkronkan data dari Google Spreadsheet atau gunakan database SQL di browser.</p>
            <div class="flex flex-wrap gap-2">
              <span class="badge"><i class="fa-solid fa-qrcode"></i><span>Barcode CODE128</span></span>
              <span class="badge"><i class="fa-solid fa-camera"></i><span>Scanner Otomatis</span></span>
              <span class="badge"><i class="fa-solid fa-database"></i><span>SQLite (sql.js)</span></span>
              <span class="badge"><i class="fa-solid fa-file-csv"></i><span>Google Sheets CSV</span></span>
            </div>
          </div>
          <div class="w-full h-48 md:h-40 lg:h-48 rounded-xl overflow-hidden border border-sky-400/20 bg-sky-950/30">
            <img
              src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/1f760514-eded-47ee-a04a-41dc3256348f.png"
              alt="Pemandangan gerbang keamanan kantor modern pada sore hari, petugas keamanan sedang memindai barcode pada kaca mobil menggunakan pemindai, suasana profesional dan aman dengan lampu jalan lembut dan gedung kantor di latar belakang, gaya fotografi realistis berwarna biru kehijauan"
              class="w-full h-full object-cover"
              onerror="this.onerror=null; this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/e3b4aa07-b687-418b-81b3-efab53819a9b.png';"
            />
          </div>
        </div>
      </section>

      <section id="dashboard" class="tab-section fade-in">
        <div class="grid-auto-fit">
          <div class="card p-5 rounded-xl">
            <div class="text-slate-400 text-sm">Total Permit</div>
            <div class="mt-2 text-3xl font-semibold" id="statTotal">0</div>
          </div>
          <div class="card p-5 rounded-xl">
            <div class="text-slate-400 text-sm">Aktif</div>
            <div class="mt-2 text-3xl font-semibold text-emerald-300" id="statActive">0</div>
          </div>
          <div class="card p-5 rounded-xl">
            <div class="text-slate-400 text-sm">Kadaluarsa</div>
            <div class="mt-2 text-3xl font-semibold text-rose-300" id="statExpired">0</div>
          </div>
          <div class="card p-5 rounded-xl">
            <div class="text-slate-400 text-sm">Scan Hari Ini</div>
            <div class="mt-2 text-3xl font-semibold text-sky-300" id="statTodayScans">0</div>
          </div>
        </div>
        <div class="grid md:grid-cols-2 gap-6 mt-6">
          <div class="card p-5 rounded-xl">
            <h3 class="font-semibold mb-3">Petunjuk Singkat</h3>
            <ol class="list-decimal list-inside text-slate-300 space-y-2">
              <li>Pilih tab "Impor/Ekspor" untuk mengimpor data dari Google Sheets (CSV) atau unggah file CSV Anda.</li>
              <li>Atau, gunakan tab "Tambah Permit" untuk menambah data baru dan generate barcode secara otomatis.</li>
              <li>Gunakan tab "Scan Barcode" untuk memindai menggunakan kamera. Sistem otomatis cocokkan dengan data, tampilkan detail, dan catat log.</li>
              <li>Gunakan "Simpan ke Browser" agar database tersimpan dan kembali saat membuka lagi.</li>
            </ol>
          </div>
          <div class="card p-5 rounded-xl">
            <h3 class="font-semibold mb-3">Format Kolom CSV yang Didukung</h3>
            <div class="text-slate-300">
              Header yang direkomendasikan:
              <div class="mt-2 grid grid-cols-2 gap-2 text-sm">
                <span class="badge">permit_code</span>
                <span class="badge">plate</span>
                <span class="badge">owner</span>
                <span class="badge">type</span>
                <span class="badge">valid_from (YYYY-MM-DD)</span>
                <span class="badge">valid_to (YYYY-MM-DD)</span>
                <span class="badge">status</span>
                <span class="badge">notes</span>
              </div>
              <p class="mt-3 text-sm text-slate-400">Sistem akan berusaha memetakan kolom umum berbahasa Indonesia atau Inggris (misal "nopol", "nomor polisi", "pemilik").</p>
            </div>
          </div>
        </div>
      </section>

      <section id="data" class="tab-section hidden fade-in">
        <div class="card p-5 rounded-xl space-y-4">
          <div class="flex flex-col md:flex-row md:items-center gap-3">
            <div class="flex-1 relative">
              <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
              <input id="searchInput" type="text" placeholder="Cari permit: kode/plat/pemilik/jenis..." class="w-full pl-10 pr-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-400/50">
            </div>
            <select id="statusFilter" class="px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              <option value="">Semua Status</option>
              <option value="active">Aktif</option>
              <option value="expired">Kadaluarsa</option>
              <option value="pending">Menunggu</option>
            </select>
            <button id="refreshTableBtn" class="px-3 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30"><i class="fa-solid fa-rotate mr-2"></i>Refresh</button>
          </div>
          <div class="table-wrap">
            <table class="min-w-full">
              <thead>
                <tr>
                  <th>Kode Permit</th>
                  <th>Plat</th>
                  <th>Pemilik</th>
                  <th>Jenis</th>
                  <th>Berlaku</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="dataTableBody" class="bg-slate-900/40"></tbody>
            </table>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-6 mt-6">
          <div class="card p-5 rounded-xl">
            <h3 class="font-semibold mb-3">Ringkasan Terpilih</h3>
            <div id="selectedInfo" class="text-slate-300 text-sm">Pilih baris data untuk melihat detail.</div>
          </div>
          <div class="card p-5 rounded-xl">
            <h3 class="font-semibold mb-3">Barcode</h3>
            <div class="flex items-center gap-3 mb-3">
              <input id="barcodeText" type="text" placeholder="Masukkan teks/kode untuk barcode" class="flex-1 px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              <button id="generateBarcodeBtn" class="px-3 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/30 hover:bg-emerald-500/30"><i class="fa-solid fa-barcode mr-2"></i>Generate</button>
            </div>
            <div class="rounded-lg border border-slate-700 p-4 bg-slate-900/40 overflow-auto">
              <svg id="barcodeSvg"></svg>
            </div>
            <div class="mt-3 flex gap-2">
              <button id="printCardBtn" class="px-3 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30"><i class="fa-solid fa-print mr-2"></i>Cetak Kartu</button>
              <button id="downloadBarcodeBtn" class="px-3 py-2 rounded-lg bg-slate-700/60 border border-slate-600 hover:bg-slate-600"><i class="fa-solid fa-download mr-2"></i>Unduh SVG</button>
            </div>
          </div>
        </div>
      </section>

      <section id="new" class="tab-section hidden fade-in">
        <div class="grid md:grid-cols-3 gap-6">
          <form id="newForm" class="md:col-span-2 card p-5 rounded-xl space-y-4">
            <h3 class="font-semibold">Tambah Permit Baru</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="text-sm text-slate-300">Kode Permit</label>
                <input id="f_permit_code" type="text" placeholder="Kosongkan untuk otomatis" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Plat Nomor</label>
                <input id="f_plate" type="text" placeholder="B 1234 ABC" required class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Pemilik</label>
                <input id="f_owner" type="text" placeholder="Nama pemilik" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Jenis Kendaraan</label>
                <input id="f_type" type="text" placeholder="Mobil/Motor/Truck" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Berlaku Dari</label>
                <input id="f_from" type="date" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Berlaku Sampai</label>
                <input id="f_to" type="date" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              </div>
              <div>
                <label class="text-sm text-slate-300">Status</label>
                <select id="f_status" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
                  <option value="active">Aktif</option>
                  <option value="pending">Menunggu</option>
                  <option value="expired">Kadaluarsa</option>
                </select>
              </div>
              <div class="md:col-span-2">
                <label class="text-sm text-slate-300">Catatan</label>
                <textarea id="f_notes" rows="2" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700" placeholder="Keterangan tambahan"></textarea>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <button class="px-4 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/30 hover:bg-emerald-500/30" type="submit"><i class="fa-solid fa-check mr-2"></i>Simpan</button>
              <button id="generateCodeBtn" class="px-4 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30" type="button"><i class="fa-solid fa-magic-wand-sparkles mr-2"></i>Generate Kode</button>
              <button class="px-4 py-2 rounded-lg bg-slate-700/60 border border-slate-600 hover:bg-slate-600" type="reset"><i class="fa-solid fa-eraser mr-2"></i>Reset</button>
            </div>
            <p id="formMsg" class="text-sm text-slate-300"></p>
          </form>

          <div class="card p-5 rounded-xl space-y-3">
            <h3 class="font-semibold">Pratinjau Kartu Permit</h3>
            <div class="print-card" id="permitPreview">
              <div class="flex items-center justify-between">
                <div class="text-xs">
                  <div class="font-semibold">PERMIT KENDARAAN</div>
                  <div class="text-slate-500">Akses Area Terbatas</div>
                </div>
                <div class="text-[10px] text-slate-500">Validasi</div>
              </div>
              <div class="hline"></div>
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div>
                  <div class="text-slate-500">Kode</div>
                  <div id="pp_code" class="font-semibold">-</div>
                </div>
                <div>
                  <div class="text-slate-500">Plat</div>
                  <div id="pp_plate" class="font-semibold">-</div>
                </div>
                <div>
                  <div class="text-slate-500">Pemilik</div>
                  <div id="pp_owner" class="font-semibold truncate">-</div>
                </div>
                <div>
                  <div class="text-slate-500">Jenis</div>
                  <div id="pp_type" class="font-semibold">-</div>
                </div>
                <div class="col-span-2">
                  <div class="text-slate-500">Masa Berlaku</div>
                  <div id="pp_valid" class="font-semibold">-</div>
                </div>
              </div>
              <div class="hline"></div>
              <div class="flex items-center justify-center">
                <svg id="pp_barcode"></svg>
              </div>
            </div>
            <div class="flex gap-2">
              <button id="printPreviewBtn" class="px-3 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30 w-full"><i class="fa-solid fa-print mr-2"></i>Cetak</button>
            </div>
          </div>
        </div>
      </section>

      <section id="scan" class="tab-section hidden fade-in">
        <div class="grid md:grid-cols-3 gap-6">
          <div class="md:col-span-2 card p-4 rounded-xl">
            <div class="flex flex-wrap items-center gap-3 mb-3">
              <select id="cameraSelect" class="px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700"></select>
              <button id="startScanBtn" class="px-3 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/30 hover:bg-emerald-500/30"><i class="fa-solid fa-play mr-2"></i>Mulai</button>
              <button id="stopScanBtn" class="px-3 py-2 rounded-lg bg-rose-500/20 border border-rose-400/30 hover:bg-rose-500/30"><i class="fa-solid fa-stop mr-2"></i>Stop</button>
              <label class="inline-flex items-center gap-2 ml-auto">
                <input id="autoLogToggle" type="checkbox" class="accent-sky-400">
                <span class="text-sm text-slate-300">Auto catat log</span>
              </label>
            </div>
            <div class="relative rounded-xl overflow-hidden border border-slate-700 bg-slate-900/50">
              <video id="video" class="w-full h-[360px] bg-black object-cover"></video>
              <div class="scanner-frame"></div>
            </div>
            <div id="scanMsg" class="mt-3 text-sm text-slate-300">Izinkan akses kamera untuk memulai pemindaian.</div>
          </div>
          <div class="card p-4 rounded-xl space-y-3">
            <h3 class="font-semibold">Hasil Scan</h3>
            <div class="text-sm text-slate-300">Kode Terbaca:</div>
            <div id="scanCode" class="px-3 py-2 rounded-lg border border-slate-700 bg-slate-900/50 font-mono">-</div>
            <div class="text-sm text-slate-300">Cocok Dengan:</div>
            <div id="scanMatch" class="rounded-lg border border-slate-700 bg-slate-900/50 p-3 text-sm">Belum ada.</div>
            <div class="flex gap-2">
              <button id="manualInBtn" class="px-3 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/30 hover:bg-emerald-500/30 w-full"><i class="fa-solid fa-door-open mr-2"></i>Catat IN</button>
              <button id="manualOutBtn" class="px-3 py-2 rounded-lg bg-amber-500/20 border border-amber-400/30 hover:bg-amber-500/30 w-full"><i class="fa-solid fa-door-closed mr-2"></i>Catat OUT</button>
            </div>
          </div>
        </div>
      </section>

      <section id="logs" class="tab-section hidden fade-in">
        <div class="card p-5 rounded-xl space-y-4">
          <div class="flex flex-col md:flex-row md:items-center gap-3">
            <div class="flex-1 relative">
              <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
              <input id="searchLogInput" type="text" placeholder="Cari log: kode/plat/event..." class="w-full pl-10 pr-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
            </div>
            <button id="clearLogsBtn" class="px-3 py-2 rounded-lg bg-rose-500/20 border border-rose-400/30 hover:bg-rose-500/30"><i class="fa-solid fa-trash mr-2"></i>Bersihkan Log</button>
          </div>
          <div class="table-wrap">
            <table class="min-w-full">
              <thead>
                <tr>
                  <th>Waktu</th>
                  <th>Event</th>
                  <th>Kode Permit</th>
                  <th>Plat</th>
                </tr>
              </thead>
              <tbody id="logsTableBody" class="bg-slate-900/40"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="import" class="tab-section hidden fade-in">
        <div class="grid md:grid-cols-2 gap-6">
          <div class="card p-5 rounded-xl space-y-3">
            <h3 class="font-semibold">Impor dari Google Sheets (CSV)</h3>
            <p class="text-sm text-slate-300">Publikasikan sheet Anda sebagai CSV: File → Share → Publish to web → Link → Entire document → CSV. Salin URL CSV dan tempel di bawah.</p>
            <div class="flex gap-2">
              <input id="csvUrlInput" type="url" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv" class="flex-1 px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
              <button id="loadCsvBtn" class="px-3 py-2 rounded-lg bg-sky-500/20 border border-sky-400/30 hover:bg-sky-500/30"><i class="fa-solid fa-cloud-arrow-down mr-2"></i>Muat</button>
            </div>
            <div id="csvMsg" class="text-sm text-slate-300"></div>
            <div class="rounded-xl overflow-hidden border border-slate-700 bg-slate-900/40">
              <img
                src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/2360737b-56a9-465a-a273-db1212f3245a.png"
                alt="Ilustrasi detail langkah demi langkah cara mempublikasikan Google Sheets menjadi file CSV, menyorot menu File, Share, Publish to web, memilih Entire document dan format CSV, gaya antarmuka minimalis"
                class="w-full h-40 object-cover"
                onerror="this.onerror=null; this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/5982ef22-8dee-4667-a6b7-83550e1c167b.png';"
              />
            </div>
          </div>

          <div class="card p-5 rounded-xl space-y-3">
            <h3 class="font-semibold">Impor CSV Lokal</h3>
            <input id="csvFileInput" type="file" accept=".csv,text/csv" class="w-full px-3 py-2 rounded-lg bg-slate-800/60 border border-slate-700">
            <div class="flex gap-2">
              <button id="importCsvBtn" class="px-3 py-2 rounded-lg bg-emerald-500/20 border border-emerald-400/30 hover:bg-emerald-500/30"><i class="fa-solid fa-file-arrow-up mr-2"></i>Impor</button>
              <button id="downloadCsvBtn" class="px-3 py-2 rounded-lg bg-slate-700/60 border border-slate-600 hover:bg-slate-600"><i class="fa-solid fa-file-csv mr-2"></i>Ekspor CSV</button>
            </div>
            <p class="text-sm text-slate-300">Catatan: Kolom yang tidak ada akan diabaikan. Duplikasi permit_code akan dilewati.</p>
          </div>
        </div>
        <div class="card p-5 rounded-xl mt-6 space-y-3">
          <h3 class="font-semibold">Reset & Utilitas</h3>
          <div class="flex flex-wrap gap-2">
            <button id="seedDataBtn" class="px-3 py-2 rounded-lg bg-indigo-500/20 border border-indigo-400/30 hover:bg-indigo-500/30"><i class="fa-solid fa-flask mr-2"></i>Isi Contoh Data</button>
            <button id="resetDbBtn" class="px-3 py-2 rounded-lg bg-rose-500/20 border border-rose-400/30 hover:bg-rose-500/30"><i class="fa-solid fa-rotate-left mr-2"></i>Reset Database</button>
          </div>
        </div>
      </section>
    </main>

    <section id="print-area" class="hidden"></section>

    <footer class="max-w-7xl mx-auto px-4 py-10 text-center text-slate-500 text-sm">
      Dibangun full di browser menggunakan HTML, CSS, dan JavaScript. Barcode oleh JsBarcode, pemindaian oleh ZXing, dan database SQLite via sql.js.
    </footer>

    <script>
      // Tailwind setup
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter','system-ui','-apple-system','Segoe UI','Roboto','Ubuntu','Cantarell','Noto Sans','Helvetica Neue','Arial','sans-serif']
            }
          }
        }
      };

      // Global state
      let SQL = null;
      let db = null;
      let zxingReader = null;
      let currentStream = null;

      const $ = (sel) => document.querySelector(sel);
      const $$ = (sel) => Array.from(document.querySelectorAll(sel));

      // Utility: format date/time
      const fmtDate = (d) => d ? new Date(d).toISOString().slice(0,10) : '';
      const nowISO = () => new Date().toISOString();
      const todayStr = () => new Date().toISOString().slice(0,10);

      // Utility: debounce

